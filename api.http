# BaseCard API Query Tests

### Variables
@baseUrl = http://localhost:4000
@aliceAddress = 0x1234567890123456789012345678901234567890
@bobAddress = 0x2345678901234567890123456789012345678901
@adminAddress = 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266

### Dev Token (bypasses auth - reads from .env)
### Variables
@devToken = {{$dotenv DEV_JWT_TOKEN}}
@aliceToken = {{$dotenv DEV_JWT_TOKEN_ALICE}}
@bobToken = {{$dotenv DEV_JWT_TOKEN_BOB}}

### ===========================================
### AUTH API (Admin)
### ===========================================

### Step 1: Get Auth Challenge for Admin
# @name adminChallenge
POST {{baseUrl}}/v1/auth/challenge
Content-Type: application/json

{
  "walletAddress": "{{adminAddress}}"
}

### Step 2: Verify Admin (Use the nonce from step 1 to sign)
# NOTE: Replace signature with actual wallet signature
# @name adminVerify
POST {{baseUrl}}/v1/auth/verify
Content-Type: application/json

{
  "walletAddress": "{{adminAddress}}",
  "signature": "YOUR_SIGNATURE_HERE"
}

### Store the JWT token from adminVerify response
@adminToken = {{adminVerify.response.body.accessToken}}

### ===========================================
### USER API
### ===========================================

### Get or Create User for alice
POST {{baseUrl}}/v1/users
Content-Type: application/json

{
  "walletAddress": "{{aliceAddress}}"
}

### Get or Create User for bob 
POST {{baseUrl}}/v1/users
Content-Type: application/json

{
  "walletAddress": "{{bobAddress}}"
}

### Get All Users
GET {{baseUrl}}/v1/users


### Update new user when bob is not 
PATCH {{baseUrl}}/v1/users/{{bobAddress}}
Content-Type: application/json

{
    "isNewUser": false
}

### Update hasMintedCard for bob
PATCH {{baseUrl}}/v1/users/{{bobAddress}}
Content-Type: application/json

{
    "hasMintedCard": true
}

### Increase User's totalPoints
PATCH {{baseUrl}}/v1/users/{{bobAddress}}/points
Content-Type: application/json

{
    "points": 100
}

### ===========================================
### BASECARD API
### ===========================================

### Create Basecard (Multipart)
POST {{baseUrl}}/v1/basecards
Content-Type: multipart/form-data; boundary=boundary

--boundary
Content-Disposition: form-data; name="nickname"

Alice
--boundary
Content-Disposition: form-data; name="role"

Developer
--boundary
Content-Disposition: form-data; name="bio"

Hello BaseCard!, I'm Alice
--boundary
Content-Disposition: form-data; name="address"

{{aliceAddress}}
--boundary
Content-Disposition: form-data; name="socials"

{"twitter": "@alice_twitter", "farcaster": "@alice.farcaster.eth"}
--boundary
Content-Disposition: form-data; name="profileImageFile"; filename="profile1.png"
Content-Type: image/png

< ./test/samples/profile1.png
--boundary--


### Create Basecard for Bob (Multipart)
POST {{baseUrl}}/v1/basecards
Content-Type: multipart/form-data; boundary=boundary

--boundary
Content-Disposition: form-data; name="nickname"

Bob
--boundary
Content-Disposition: form-data; name="role"

Designer
--boundary
Content-Disposition: form-data; name="bio"

Hello BaseCard!, I'm Bob
--boundary
Content-Disposition: form-data; name="address"

{{bobAddress}}
--boundary
Content-Disposition: form-data; name="socials"

{"twitter": "@bob_twitter", "farcaster": "@bob.farcaster.eth"}
--boundary
Content-Disposition: form-data; name="profileImageFile"; filename="profile2.png"
Content-Type: image/png

< ./test/samples/profile2.png
--boundary--


### Update Basecard for Alice (Phase 1 - Prepare for Contract Call)
# Returns { card_data, social_keys, social_values } for editBaseCard() contract call
# DB is NOT updated - update happens after contract event
PATCH {{baseUrl}}/v1/basecards/{{aliceAddress}}
Content-Type: multipart/form-data; boundary=boundary

--boundary
Content-Disposition: form-data; name="nickname"

Alice Updated
--boundary
Content-Disposition: form-data; name="role"

Senior Developer
--boundary
Content-Disposition: form-data; name="bio"

Hello BaseCard!, I'm Alice - Updated bio!
--boundary
Content-Disposition: form-data; name="socials"

{"twitter": "@alice_twitter_new", "farcaster": "@alice.farcaster.eth", "github": "@alice-dev"}
--boundary
Content-Disposition: form-data; name="profileImageFile"; filename="profile1.png"
Content-Type: image/png

< ./test/samples/profile1.png
--boundary--


### Update Basecard for Bob (without image change)
PATCH {{baseUrl}}/v1/basecards/{{bobAddress}}
Content-Type: multipart/form-data; boundary=boundary

--boundary
Content-Disposition: form-data; name="nickname"

Bob Updated
--boundary
Content-Disposition: form-data; name="role"

Lead Designer
--boundary
Content-Disposition: form-data; name="bio"

Updated bio for Bob
--boundary
Content-Disposition: form-data; name="socials"

{"twitter": "@bob_twitter_new", "github": "@bob-design"}
--boundary--


### Update Token ID
PUT {{baseUrl}}/v1/basecards/{{aliceAddress}}
Content-Type: application/json

{
  "tokenId": 123
}

### Update Token ID
PUT {{baseUrl}}/v1/basecards/{{bobAddress}}
Content-Type: application/json

{
  "tokenId": 123
}


### Get All Basecards
GET {{baseUrl}}/v1/basecards


### ===========================================
### COLLECTION API
### ===========================================

### Get User ID for Alice (Collector)
# @name getAlice
GET {{baseUrl}}/v1/users/address/{{aliceAddress}}
Authorization: Bearer {{aliceToken}}

### Get User ID for Bob (Collector)
# @name getBob
GET {{baseUrl}}/v1/users/address/{{bobAddress}}
Authorization: Bearer {{bobToken}}


### Get Alice's Card
# @name getAliceCard
GET {{baseUrl}}/v1/basecards/me
Authorization: Bearer {{devToken}}

### Get All Basecards to find card IDs
# @name getAllCards
GET {{baseUrl}}/v1/basecards

### Create Collection (Collect a BaseCard)
# JWT token determines the collector, only basecardId is needed
# First run "Get All Basecards" above to get card IDs from response
# Then use: {{getAllCards.response.body[0].id}} for first card
# Or manually copy the id from the response
POST {{baseUrl}}/v1/collections
Content-Type: application/json
Authorization: Bearer {{aliceToken}}

{
  "basecardId": "{{getBob.response.body.result.card.id}}"
}

### Request as Alice
GET {{baseUrl}}/v1/collections/me
Authorization: Bearer {{aliceToken}}
### Request as Bob
GET {{baseUrl}}/v1/collections/me
Authorization: Bearer {{bobToken}}

### Get Collections
GET {{baseUrl}}/v1/collections

### Get My Collections (JWT Required)
# Returns array of collected BaseCards for the authenticated user
GET {{baseUrl}}/v1/collections/me
Authorization: Bearer {{devToken}}

### ===========================================
### EVENTS API
### ===========================================


### Receive Contract Event (Webhook/Test)
POST {{baseUrl}}/v1/events
Content-Type: application/json

{
  "transactionHash": "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef",
  "blockNumber": 123456,
  "blockHash": "0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890",
  "logIndex": 0,
  "eventName": "MintBaseCard",
  "args": {
    "user": "{{aliceAddress}}",
    "tokenId": 1
  }
}

### Get All Events
GET {{baseUrl}}/v1/events

### ===========================================
### User Quests (user_quests table)
### ===========================================

### Get All User Quests
GET {{baseUrl}}/v1/user-quests

### ===========================================
### Quests (Public)
### ===========================================

### Get Active Quests (Public - no auth required)
GET {{baseUrl}}/v1/quests/active

### Get Quests for Alice (includes user completion status)
GET {{baseUrl}}/v1/quests/user/{{aliceAddress}}

### Get Quests for Bob (includes user completion status)
GET {{baseUrl}}/v1/quests/user/{{bobAddress}}

### ===========================================
### ADMIN: Quest Management (Requires Auth)
### ===========================================

### Get Quest Types (platforms, actionTypes, frequencies)
GET {{baseUrl}}/v1/quests/types
Authorization: Bearer {{devToken}}

### Get All Quests (Admin)
GET {{baseUrl}}/v1/quests
Authorization: Bearer {{devToken}}

### Create Quest: Follow on Twitter (X_FOLLOW)
POST {{baseUrl}}/v1/quests
Content-Type: application/json
Authorization: Bearer {{devToken}}

{
  "title": "Follow @basecardteam on Twitter",
  "description": "Follow the official BaseCard Twitter account",
  "platform": "TWITTER",
  "actionType": "X_FOLLOW",
  "frequency": "ONCE",
  "rewardAmount": 100
}

### Create Quest: Follow on Farcaster (FC_FOLLOW)
POST {{baseUrl}}/v1/quests
Content-Type: application/json
Authorization: Bearer {{devToken}}

{
  "title": "Follow @basecardteam on Farcaster",
  "description": "Follow the official BaseCard Farcaster account",
  "platform": "FARCASTER",
  "actionType": "FC_FOLLOW",
  "frequency": "ONCE",
  "rewardAmount": 100
}

### Create Quest: Post with Hashtag (FC_POST_HASHTAG)
POST {{baseUrl}}/v1/quests
Content-Type: application/json
Authorization: Bearer {{devToken}}

{
  "title": "Post #BaseCardAdvent",
  "description": "Post on Farcaster with #BaseCardAdvent hashtag",
  "platform": "FARCASTER",
  "actionType": "FC_POST_HASHTAG",
  "frequency": "ONCE",
  "rewardAmount": 300
}

### Create Quest: Manual Screenshot Quest (APP_MANUAL)
POST {{baseUrl}}/v1/quests
Content-Type: application/json
Authorization: Bearer {{devToken}}

{
  "title": "Share your BaseCard screenshot",
  "description": "Take a screenshot of your BaseCard and share it. Submit the URL for admin review.",
  "platform": "APP",
  "actionType": "APP_MANUAL",
  "frequency": "ONCE",
  "rewardAmount": 500
}

### Create Quest: Daily Check-in (Daily)
POST {{baseUrl}}/v1/quests
Content-Type: application/json
Authorization: Bearer {{devToken}}

{
  "title": "Daily Check-in",
  "description": "Check in daily to earn points",
  "platform": "APP",
  "actionType": "APP_DAILY_CHECKIN",
  "frequency": "DAILY",
  "cooldownSecond": 86400,
  "rewardAmount": 50
}

### Get Quest by ID
@questId = 1b4b3609-3e64-4b26-841a-2209aa5e1134
GET {{baseUrl}}/v1/quests/{{questId}}
Authorization: Bearer {{devToken}}

### Update Quest
PATCH {{baseUrl}}/v1/quests/{{questId}}
Content-Type: application/json
Authorization: Bearer {{devToken}}

{
  "rewardAmount": 150
}

### Activate Quest
PATCH {{baseUrl}}/v1/quests/{{questId}}/activate
Authorization: Bearer {{devToken}}

### Deactivate Quest
PATCH {{baseUrl}}/v1/quests/{{questId}}/deactivate
Authorization: Bearer {{devToken}}

### Delete Quest
DELETE {{baseUrl}}/v1/quests/{{questId}}
Authorization: Bearer {{devToken}}
